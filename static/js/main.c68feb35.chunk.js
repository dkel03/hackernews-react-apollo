(this["webpackJsonphackernews-react-apollo"]=this["webpackJsonphackernews-react-apollo"]||[]).push([[0],{52:function(e,n,t){e.exports=t(75)},57:function(e,n,t){},65:function(e,n,t){},75:function(e,n,t){"use strict";t.r(n);var a=t(49),r=t(1),c=t.n(r),i=t(41),o=t.n(i),l=t(18);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var u=t(6),s=t(19),m=t(46),d=t(50),p=t(47),f=t(11),v=t(51),h=t(2),b=t(8),g=(t(57),Object(b.g)((function(e){var n=e.history,t=localStorage.getItem("auth-token");return c.a.createElement("div",{className:"flex pa1 justify-between nowrap orange"},c.a.createElement("div",{className:"flex flex-fixed black"},c.a.createElement("div",{className:"fw7 mr1"},c.a.createElement(l.b,{to:"/",className:"ml1 no-underline black"},"Hacker News")),c.a.createElement(l.b,{to:"/",className:"ml1 no-underline black"},"new"),c.a.createElement("div",{className:"ml1"},"|"),c.a.createElement(l.b,{to:"/top",className:"ml1 no-underline black"},"top"),c.a.createElement("div",{className:"ml1"},"|"),c.a.createElement(l.b,{to:"/search",className:"ml1 no-underline black"},"search"),t&&c.a.createElement("div",{className:"flex"},c.a.createElement("div",{className:"ml1"},"|"),c.a.createElement(l.b,{to:"/create",className:"ml1 no-underline black"},"submit"))),c.a.createElement("div",{className:"flex flex-fixed"},t?c.a.createElement("div",{className:"ml1 pointer black",onClick:function(){localStorage.removeItem("auth-token"),n.push("/")}},"logout"):c.a.createElement(l.b,{to:"/login",className:"ml1 no-underline black"},"login")))}))),k=t(48),E=t(13),y=t(29),w=t(14),j=t.n(w);function O(e){return function(e,n){var t=e-n;return t<2e4?"just now":t<6e4?"less than 1 min ago":t<36e5?Math.round(t/6e4)+" min ago":t<864e5?Math.round(t/36e5)+" h ago":t<2592e6?Math.round(t/864e5)+" days ago":t<31536e6?Math.round(t/2592e6)+" mo ago":Math.round(t/31536e6)+" years ago"}((new Date).getTime(),new Date(e).getTime())}function N(){var e=Object(E.a)(["\n  mutation VoteMutation($linkId: ID!) {\n    vote(linkId: $linkId) {\n      id\n      link {\n        id\n        votes {\n          id\n          user {\n            id\n          }\n        }\n      }\n      user {\n        id\n      }\n    }\n  }\n"]);return N=function(){return e},e}var x=j()(N()),S=function(e){var n=e.index,t=e.link,a=e.updateStoreAfterVote,r=localStorage.getItem("auth-token");return c.a.createElement("div",{className:"flex mt2 items-start"},c.a.createElement("div",{className:"flex items-center"},c.a.createElement("span",{className:"gray"},n+1,"."),r&&c.a.createElement(y.a,{mutation:x,variables:{linkId:t.id},update:function(e,n){var r=n.data.vote;return a(e,r,t.id)}},(function(e){return c.a.createElement("div",{className:"ml1 gray f11",onClick:e},"\u25b2")}))),c.a.createElement("div",{className:"ml1"},c.a.createElement("div",null,t.description," (",t.url,")"),c.a.createElement("div",{className:"f6 lh-copy gray"},t.votes.length," votes | by"," ",t.postedBy?t.postedBy.name:"Unknown"," ",O(t.createdAt))))};function $(){var e=Object(E.a)(["\n  subscription {\n    newVote {\n      id\n      link {\n        id\n        url\n        description\n        createdAt\n        postedBy {\n          id\n          name\n        }\n        votes {\n          id\n          user {\n            id\n          }\n        }\n      }\n      user {\n        id\n      }\n    }\n  }\n"]);return $=function(){return e},e}function C(){var e=Object(E.a)(["\n  subscription {\n    newLink {\n      id\n      url\n      description\n      createdAt\n      postedBy {\n        id\n        name\n      }\n      votes {\n        id\n        user {\n          id\n        }\n      }\n    }\n  }\n"]);return C=function(){return e},e}function I(){var e=Object(E.a)(["\n  query FeedQuery($first: Int, $skip: Int, $orderBy: LinkOrderByInput) {\n    feed(first: $first, skip: $skip, orderBy: $orderBy) {\n      links {\n        id\n        createdAt\n        url\n        description\n        postedBy {\n          id\n          name\n        }\n        votes {\n          id\n          user {\n            id\n          }\n        }\n      }\n      count\n    }\n  }\n"]);return I=function(){return e},e}var B=j()(I()),A=j()(C()),q=j()($()),M=function(e){var n=function(n,t,a){var r=e.location.pathname.includes("new"),c=parseInt(e.match.params.page,10),i=r?5*(c-1):0,o=r?5:100,l=r?"createdAt_DESC":null,u=n.readQuery({query:B,variables:{first:o,skip:i,orderBy:l}});u.feed.links.find((function(e){return e.id===a})).votes=t.link.votes,n.writeQuery({query:B,data:u})},t=function(){var n=parseInt(e.match.params.page,10);if(n>1){var t=n-1;e.history.push("/new/".concat(t))}};return c.a.createElement(y.b,{query:B,variables:function(){var n=e.location.pathname.includes("new"),t=parseInt(e.match.params.page,10);return{first:n?5:100,skip:n?5*(t-1):0,orderBy:n?"createdAt_DESC":null}}()},(function(a){var i=a.loading,o=a.error,l=a.data,u=a.subscribeToMore;if(i)return c.a.createElement("div",null,"Fetching");if(o)return c.a.createElement("div",null,"Error");!function(e){e({document:A,updateQuery:function(e,n){var t=n.subscriptionData;if(!t.data)return e;var a=t.data.newLink;return e.feed.links.find((function(e){return e.id===a.id}))?e:Object.assign({},e,{feed:{links:[a].concat(Object(k.a)(e.feed.links)),count:e.feed.links.length+1,__typename:e.feed.__typename}})}})}(u),function(e){e({document:q})}(u);var s=function(n){if(e.location.pathname.includes("new"))return n.feed.links;var t=n.feed.links.slice();return t.sort((function(e,n){return n.votes.length-e.votes.length})),t}(l),m=e.location.pathname.includes("new"),d=e.match.params.page?5*(e.match.params.page-1):0;return c.a.createElement(r.Fragment,null,s.map((function(e,t){return c.a.createElement(S,{key:e.id,link:e,index:t+d,updateCacheAfterVote:n})})),m&&c.a.createElement("div",{className:"flex ml4 mv3 gray"},c.a.createElement("div",{className:"pointer mr2",onClick:t},"Previous"),c.a.createElement("div",{className:"pointer",onClick:function(){return function(n){var t=parseInt(e.match.params.page,10);if(t<=n.feed.count/5){var a=t+1;e.history.push("/new/".concat(a))}}(l)}},"Next")))}))},D=t(17);function _(){var e=Object(E.a)(["\n  mutation PostMutation($description: String!, $url: String!) {\n    post(description: $description, url: $url) {\n      id\n      createdAt\n      url\n      description\n    }\n  }\n"]);return _=function(){return e},e}var Q=j()(_()),L=function(e){var n=e.history,t=Object(r.useState)(""),a=Object(D.a)(t,2),i=a[0],o=a[1],l=Object(r.useState)(""),u=Object(D.a)(l,2),s=u[0],m=u[1];return c.a.createElement("div",null,c.a.createElement("div",{className:"flex flex-column mt3"},c.a.createElement("input",{className:"mb2",value:i,onChange:function(e){return o(e.target.value)},type:"text",placeholder:"A description for the link"}),c.a.createElement("input",{className:"mb2",value:s,onChange:function(e){return m(e.target.value)},type:"text",placeholder:"The URL for the link"})),c.a.createElement(y.a,{mutation:Q,variables:{description:i,url:s},onCompleted:function(){return n.push("/new/1")},update:function(e,n){var t=n.data.post,a=e.readQuery({query:B,variables:{first:5,skip:0,orderBy:"createdAt_DESC"}});a.feed.links.unshift(t),e.writeQuery({query:B,data:a,variables:{first:5,skip:0,orderBy:"createdAt_DESC"}})}},(function(e){return c.a.createElement("button",{onClick:e},"Submit")})))},T=t(21),F=t.n(T),V=t(28);function P(){var e=Object(E.a)(["\n  mutation LoginMutation($email: String!, $password: String!) {\n    login(email: $email, password: $password) {\n      token\n    }\n  }\n"]);return P=function(){return e},e}function U(){var e=Object(E.a)(["\n  mutation SignupMutation($email: String!, $password: String!, $name: String!) {\n    signup(email: $email, password: $password, name: $name) {\n      token\n    }\n  }\n"]);return U=function(){return e},e}var J=j()(U()),W=j()(P()),Y=function(e){var n=e.history,t=Object(r.useState)(!0),a=Object(D.a)(t,2),i=a[0],o=a[1],l=Object(r.useState)(""),u=Object(D.a)(l,2),s=u[0],m=u[1],d=Object(r.useState)(""),p=Object(D.a)(d,2),f=p[0],v=p[1],h=Object(r.useState)(""),b=Object(D.a)(h,2),g=b[0],k=b[1],E=function(){var e=Object(V.a)(F.a.mark((function e(t){var a,r;return F.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=i?t.login:t.signup,r=a.token,w(r),n.push("/");case 3:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),w=function(e){localStorage.setItem("auth-token",e)};return c.a.createElement("div",null,c.a.createElement("h4",{className:"mv3"},i?"Login":"Sign Up"),c.a.createElement("div",{className:"flex flex-column"},!i&&c.a.createElement("input",{value:g,onChange:function(e){return k(e.target.value)},type:"text",placeholder:"Your name"}),c.a.createElement("input",{value:s,onChange:function(e){return m(e.target.value)},type:"text",placeholder:"Your email address"}),c.a.createElement("input",{value:f,onChange:function(e){return v(e.target.value)},type:"password",placeholder:"Choose a safe password"})),c.a.createElement("div",{className:"flex mt3"},c.a.createElement(y.a,{mutation:i?W:J,variables:{email:s,password:f,name:g},onCompleted:function(e){return E(e)}},(function(e){return c.a.createElement("div",{className:"pointer mr2 button",onClick:e},i?"login":"create account")})),c.a.createElement("div",{className:"pointer button",onClick:function(){return o(!i)}},i?"need to create an account?":"already have an account?")))},z=t(76);function H(){var e=Object(E.a)(["\n  query FeedSearchQuery($filter: String!) {\n    feed(filter: $filter) {\n      links {\n        id\n        url\n        description\n        createdAt\n        postedBy {\n          id\n          name\n        }\n        votes {\n          id\n          user {\n            id\n          }\n        }\n      }\n    }\n  }\n"]);return H=function(){return e},e}var R=j()(H()),G=Object(z.a)((function(e){var n=e.client,t=Object(r.useState)([]),a=Object(D.a)(t,2),i=a[0],o=a[1],l=Object(r.useState)(""),u=Object(D.a)(l,2),s=u[0],m=u[1],d=function(){var e=Object(V.a)(F.a.mark((function e(){var t,a;return F.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.query({query:R,variables:{filter:s}});case 2:t=e.sent,a=t.data.feed.links,o(a);case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return c.a.createElement("div",null,c.a.createElement("div",null,c.a.createElement("input",{type:"text",onChange:function(e){return m(e.target.value)}}),c.a.createElement("button",{onClick:function(){return d()}},"search")),i.length?i.map((function(e,n){return c.a.createElement(S,{key:e.id,link:e,index:n})})):c.a.createElement("div",null,"nothing"))}));var K=function(){return c.a.createElement("div",{className:"center w85"},c.a.createElement(g,null),c.a.createElement("div",{className:"ph3 pv1 background-gray"},c.a.createElement(b.d,null,c.a.createElement(b.b,{exact:!0,path:"/",render:function(){return c.a.createElement(b.a,{to:"/new/1"})}}),c.a.createElement(b.b,{exact:!0,path:"/create",component:L}),c.a.createElement(b.b,{exact:!0,path:"/login",component:Y}),c.a.createElement(b.b,{exact:!0,path:"/search",component:G}),c.a.createElement(b.b,{exact:!0,path:"/top",component:M}),c.a.createElement(b.b,{exact:!0,path:"/new/:page",component:M}))))},X=(t(65),Object(m.a)({uri:"https://hackernews-back.herokuapp.com/"})),Z=Object(d.a)((function(e,n){var t=n.headers,r=localStorage.getItem("auth-token");return{headers:Object(a.a)({},t,{authorization:r?"Bearer ".concat(r):""})}})),ee=new v.a({uri:"ws://hackernews-back.herokuapp.com",options:{reconnect:!0,connectionParams:{authToken:localStorage.getItem("auth-token")}}}),ne=Object(f.d)((function(e){var n=e.query,t=Object(h.l)(n),a=t.kind,r=t.operation;return"OperationDefinition"===a&&"subscription"===r}),ee,Z.concat(X)),te=new s.a({link:ne,cache:new p.a});o.a.render(c.a.createElement(l.a,null,c.a.createElement(u.b,{client:te},c.a.createElement(K,null))),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[52,1,2]]]);
//# sourceMappingURL=main.c68feb35.chunk.js.map